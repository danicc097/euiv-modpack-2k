#Castilian Missions
#by Isildur

vn_cas_missions_slot_1_a = {
    slot = 6
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_patronize_holy_orders = {
        icon = mission_european_church
        completed_by = 1172.1.1
        required_missions = {  }
        trigger = {
            if = {
                limit = { has_estate = estate_church }
                estate_loyalty = {
                    estate = estate_church
                    loyalty = 60
                }
                num_of_estate_privileges = {
                    estate = estate_church
                    value = 3
                }
            }
            else = {
                num_of_owned_provinces_with = {
                    value = 5
                    has_tax_building_trigger = yes
                }
            }
            num_of_states_owned_or_owned_by_non_sovereign_subjects_with = {
                has_holy_order_trigger = yes
                value = 5
            }
        }
        effect = {
            add_estate_church_loyalty_effect = yes
            add_country_modifier = {
                name = "cas_patronize_holy_orders_mission"
                duration = 9125
            }
        }
	}
    vn_cas_cortes_of_castile = {
        icon = mission_noble_council
        completed_by = 1188.1.1
		required_missions = { vn_cas_patronize_holy_orders }
		provinces_to_highlight = {
			OR = {
				province_id = 844
				province_id = 519
                province_id = 4328
                province_id = 2160
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		trigger = {
			has_3_advisors_trigger = yes
			employed_advisor = {
				culture = leonese
			}
			OR = {
				employed_advisor = {
					culture = galician
				}
				employed_advisor = {
					culture = basque
				}
			}
			owns_core_province = 844
            owns_core_province = 519
            OR = {
                owns_core_province = 4328
                owns_core_province = 2160
            }
		}
		effect = {
			add_corruption = -2
			add_country_modifier = {
				name = "cas_cortes_of_castile_mission"
				duration = 9125
			}
		}
    }
	vn_cas_establish_mesta = {
        icon = mission_trade_company_region_abroad
        completed_by = 1273.1.1
		required_missions = { vn_cas_cortes_of_castile }
		position = 4
        trigger = {
            wool = 5
            any_owned_province = {
                trade_goods = wool
                development = 10
            }
        }
        effect = {
            every_owned_province = {
                limit = { 
                    superregion = iberia_superregion
                    trade_goods = wool 
                }
                add_base_production = 2
                add_province_modifier = {
                    name = "cas_establish_mesta_mission"
                    duration = 9125
                }
            }
        }
    }
}

vn_cas_missions_slot_1_b = {
    slot = 6
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_dynastic_claims = {
        icon = mission_empire
        completed_by = 1072.1.1
        required_missions = { }
        position = 5
        trigger = {
            custom_trigger_tooltip = {
                tooltip = vn_cas_dynastic_claims.tt
                has_global_flag = lon_split_flag
            }
            stability = 1
            is_free_or_tributary_trigger = yes
            if = {
                limit = { government = monarchy }
                num_of_royal_marriages = 2
                legitimacy = 100
            }
            else = {
                num_of_allies = 2
            }
        }
        effect = {
            add_stability_or_adm_power = yes
            if = {
                limit = {
                    tag = CAS
                }
                leonese_region = {
                    limit = {
                        NOT = { is_core = ROOT }
                        NOT = { is_permanent_claim = ROOT }
                    }
                    add_permanent_claim = ROOT
                }
                asturian_region = {
                    limit = {
                        NOT = { is_core = ROOT }
                        NOT = { is_permanent_claim = ROOT }
                    }
                    add_permanent_claim = ROOT
                }
            }
            else_if = {
                limit = {
                    tag = LON
                }
                castile_region = {
                    limit = {
                        NOT = { is_core = ROOT }
                        NOT = { is_permanent_claim = ROOT }
                    }
                    add_permanent_claim = ROOT
                }
                asturian_region = {
                    limit = {
                        NOT = { is_core = ROOT }
                        NOT = { is_permanent_claim = ROOT }
                    }
                    add_permanent_claim = ROOT
                }
            }
        }
    }
    vn_cas_subjugate_galicia = {
        icon = mission_unite_home_region    #placeholder
        completed_by = 1072.1.1
        required_missions = { vn_cas_dynastic_claims }
        provinces_to_highlight = {
            OR = {
                area = galicia_area
                area = ourense_area
            }
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            galicia_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
            ourense_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
            add_prestige_or_monarch_power = { amount = 10 } 
            add_adm_power = 25
            galicia_area = {
                limit = { NOT = { is_core = GAL } }
                add_core = GAL
            }
            ourense_area = {
                limit = { NOT = { is_core = GAL } }
                add_core = GAL
            }
            galicia_area = {
                limit = { country_or_non_sovereign_subject_holds = ROOT }
                add_province_modifier = {
                    name = "cas_subjugate_galicia_mission"
                    duration = 1825
                }
            }
            ourense_area = {
                limit = { country_or_non_sovereign_subject_holds = ROOT }
                add_province_modifier = {
                    name = "cas_subjugate_galicia_mission"
                    duration = 1825
                }
            }
        }
    }
    vn_cas_crown_of_castile = {
        icon = mission_castillian_aggression
        completed_by = 1301.1.1
        required_missions = { 
            vn_cas_subjugate_galicia
            vn_cas_subjugate_leon 
		}
		provinces_to_highlight = {
			OR = {
				province_id = 519
				province_id = 844
				province_id = 4328
				province_id = 1208
				province_id = 267
				province_id = 74
				province_id = 1867
				province_id = 2670
			}
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
        trigger = {
            government_rank = 5
            if = {
                limit = { has_dlc = "Common Sense" }
                legitimacy_equivalent = 90
            }
            else_if = {
                limit = { government = monarchy }
                legitimacy = 90
            }
            owns_core_province = 519
            owns_core_province = 844
            owns_core_province = 4328
            owns_core_province = 1208
            owns_core_province = 267
            owns_core_province = 74
            owns_core_province = 1867
			owns_core_province = 2670
			custom_trigger_tooltip = {
                tooltip = vn_cas_crown_of_castile.tt
                OR = {
					has_country_flag = had_cas_civil_war
					current_age = age_of_reformation
                    current_age = age_of_absolutism
                    current_age = age_of_revolutions
                    current_age = age_of_ideology
                }
            }
        }
        effect = {
			soria_area = {
				limit = { owned_by = ROOT }
				add_province_modifier = {
					name = "cas_crown_of_castile_mission"
					duration = 7300
				}
			}
			leon_area = {
				limit = { owned_by = ROOT }
				add_province_modifier = {
					name = "cas_crown_of_castile_mission"
					duration = 7300
				}
			}
			galicia_area = {
				limit = { owned_by = ROOT }
				add_province_modifier = {
					name = "cas_crown_of_castile_mission"
					duration = 7300
				}
			}
			1208 = {
				move_capital_effect = yes
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
            aragon_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
            }
            catalunya_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
            }
            valencian_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
            }
            beiras_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
            }
            alentejo_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
        }
    }
    vn_cas_subjugate_aragon = {
        icon = king_of_aragon
        completed_by = 1479.9.4
        required_missions = { vn_cas_crown_of_castile }
        provinces_to_highlight = {
            OR = {
                region = aragon_region
                region = catalunya_region
                region = valencian_region
            }
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            aragon_region = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
            catalunya_region = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
            valencian_region = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			add_prestige_or_monarch_power = { amount = 20 } 
			add_mil_power = 75
			add_country_modifier = {
				name = "ara_iberian_wedding_mission"
				duration = 9125
			}
			aragon_region = {
				limit = { NOT = { is_core = ARA } }
				add_core = ARA
			}
			catalunya_region = {
				limit = { NOT = { is_core = CAT } }
				add_core = CAT
			}
			valencia_area = {
				limit = { NOT = { is_core = AVL } }
				add_core = AVL
			}
			denia_area = {
				limit = { NOT = { is_core = AVL } }
				add_core = AVL
			}
            balears_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
        }
    }
    vn_cas_invade_baleares = {
        icon = mission_invade_island
        completed_by = 1479.9.4
        required_missions = { vn_cas_subjugate_aragon }
        position = 9
		provinces_to_highlight = {
			area = balears_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			balears_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		effect = {
			balears_area = {
				limit = { NOT = { is_core = MJO } }
				add_core = MJO
			}
			sassari_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			arborea_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			gallura_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}	
    }
}

vn_cas_missions_slot_2_a = {
    slot = 7
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_extremadura_campaign = {
        icon = dom_ara_remensa_war
        completed_by = 1243.1.1
        required_missions = { vn_cas_prepare_reconquista }
        position = 2
        provinces_to_highlight = {
            region = extremadura_region
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            extremadura_region = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			1212 = {
				if = {
					limit = {
						NOT = { 
							has_fort_building_trigger = yes
							num_free_building_slots = 1
						}
					} 
					add_building = fort_14th
				}
			}
			caceres_area = {
				limit = { NOT = { is_core = LON } }
				add_core = LON
			}
			badajoz_area = {
				limit = { NOT = { is_core = LON } }
				add_core = LON
			}
			plasencia_area = {
				limit = { NOT = { is_core = CTL } }
				add_core = CTL
			}
            huelva_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
            }
            sevilla_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			} 
        }
    }
    vn_cas_claim_sevilla = {
        icon = mission_unite_home_region    #placeholder
         completed_by = 1264.9.22
		required_missions = { vn_cas_extremadura_campaign }
		position = 4
        provinces_to_highlight = {
            OR = {
                area = huelva_area
                area = sevilla_area
            }
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            huelva_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
            sevilla_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			huelva_area = {
				limit = { NOT = { is_core = CSE } }
				add_core = CSE
			}
			sevilla_area = {
				limit = { NOT = { is_core = CSE } }
				add_core = CSE
			}
            1867 = {
                add_province_modifier = {
                    name = "cas_claim_sevilla_mission"
                    duration = 9125
                }
            }
        }
    }
}

vn_cas_missions_slot_2_b = {
    slot = 7
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_subjugate_leon = {
        icon = mission_unite_home_region    #placeholder
        completed_by = 1085.1.1
        required_missions = { vn_cas_dynastic_claims }
        position = 6
        provinces_to_highlight = {
            OR = {
                region = leonese_region
                area = asturias_area
                region = castile_region
            }
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            if = {
                limit = {
                    OR = {
                        tag = CAS
                        was_tag = CAS
                    }
                }
                leonese_region = {
                    type = all
                    country_or_non_sovereign_subject_holds = ROOT
                }
                asturias_area = {
                    type = all
                    country_or_non_sovereign_subject_holds = ROOT
                }
            }
            else_if = {
                limit = {
                    OR = {
                        tag = LON
                        was_tag = LON
                    }
                }
                castile_region = {
                    type = all
                    country_or_non_sovereign_subject_holds = ROOT
                }
            }
        }
        effect = {
            add_prestige_or_monarch_power = { amount = 10 } 
            add_adm_power = 25
            if = {
                limit = {
                    OR = {
                        tag = CAS
                        was_tag = CAS
                    }
                }
                leonese_region = {
                    limit = { NOT = { is_core = LON } }
                    add_core = LON
                }
                asturias_area = {
                    limit = { NOT = { is_core = ASU } }
                    add_core = ASU
                }
                leonese_region = {
                    limit = { country_or_non_sovereign_subject_holds = ROOT }
                    add_province_modifier = {
                        name = "cas_subjugate_galicia_mission"
                        duration = 1825
                    }
                }
                asturias_area = {
                    limit = { country_or_non_sovereign_subject_holds = ROOT }
                    add_province_modifier = {
                        name = "cas_subjugate_galicia_mission"
                        duration = 1825
                    }
                }
            }
            else_if = {
                limit = {
                    OR = {
                        tag = LON
                        was_tag = LON
                    }
                }
                castile_region = {
                    limit = { NOT = { is_core = CAS } }
                    add_core = CAS
                }
                castile_region = {
                    limit = { country_or_non_sovereign_subject_holds = ROOT }
                    add_province_modifier = {
                        name = "cas_subjugate_galicia_mission"
                        duration = 1825
                    }
                }
            }
        }
    }
}

vn_cas_missions_slot_2_c = {
    slot = 7
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_school_of_salamanca = {
        icon = hispanic_monarchy
        completed_by = 1550.1.1
        required_missions = { vn_cas_triumph_over_islam }
        position = 7
        provinces_to_highlight = {
            province_id = 2718
        }
        trigger = {
            2718 = {
                owned_by = ROOT
                is_core = ROOT
                development = 20
                has_building = university 
            }
			has_institution = renaissance
			all_state_province = {
				renaissance = 100
			}
            full_idea_group = humanist_ideas
        }
        effect = {
            add_country_modifier = {
                name = "cas_school_of_salamanca_mission"
                duration = 10950
            }
        }
    }
}

vn_cas_missions_slot_2_d = {
    slot = 7
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_portuguese_question = {
        icon = mission_union_with_portugal
        completed_by = 1580.8.26
        required_missions = { vn_cas_crown_of_castile }
        position = 8
        provinces_to_highlight = {
            OR = {
                region = beiras_region
                region = alentejo_region
            }
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            OR = {
                AND = {
                    alliance_with = POR
                    marriage_with = POR
                    reverse_has_opinion = {
                        who = POR
                        value = 150
                    }
                }
                AND = {
                    beiras_region = {
                        type = all
                        country_or_non_sovereign_subject_holds = ROOT
                    }
                    alentejo_region = {
                        type = all
                        country_or_non_sovereign_subject_holds = ROOT
                    }
                }
            }
        }
        effect = {
            add_prestige_or_monarch_power = { amount = 10 } 
            if = {
                limit = {
                    beiras_region = {
                        type = all
                        country_or_non_sovereign_subject_holds = ROOT
                    }
                    alentejo_region = {
                        type = all
                        country_or_non_sovereign_subject_holds = ROOT
                    }
                }
                add_country_modifier = {
                    name = "ara_aragonese_portugal_mission"
                    duration = 9125
                }
            }
            else = {
                add_dip_power = 100
            }
        }
	}
	vn_cas_islas_canarias = {	
        icon = mission_claim_the_canaries
        completed_by = 1496.2.1
        required_missions = { }
        position = 8
        provinces_to_highlight = {
            OR = {
				province_id = 5113
				province_id = 5112
				province_id = 5111
				province_id = 5110
				province_id = 5109
				province_id = 5108
				province_id = 5107
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
			5113 = { country_or_non_sovereign_subject_holds = ROOT }
			5112 = { country_or_non_sovereign_subject_holds = ROOT }
			5111 = { country_or_non_sovereign_subject_holds = ROOT }
			5110 = { country_or_non_sovereign_subject_holds = ROOT }
			5109 = { country_or_non_sovereign_subject_holds = ROOT }
			5108 = { country_or_non_sovereign_subject_holds = ROOT }
			5107 = { country_or_non_sovereign_subject_holds = ROOT }
        }
        effect = {
            5110 = {
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
        }
    }
}

vn_cas_missions_slot_3_a = {
    slot = 8
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_prepare_reconquista = {
        icon = mission_build_up_to_force_limit
        required_missions = { }
        completed_by = 1055.1.1
		position = 1
		provinces_to_highlight = {
			OR = {
				province_id = 4371
				province_id = 2850
				province_id = 2719
				province_id = 4370
				province_id = 4369
				province_id = 2337
                province_id = 4474
                province_id = 4344
				province_id = 2718
				province_id = 4346
				province_id = 4345
				province_id = 4347
			}
			NOT = { owned_by = ROOT }
		}
        trigger = {
			army_size_percentage = 0.75
			num_of_generals = 1
			NOT = { num_of_loans = 1 }
			NOT = { war_exhaustion = 1 }
			NOT = {
				any_owned_province = {
					controlled_by = REB
				}
			}
			custom_trigger_tooltip = {
				tooltip = vn_ara_prepare_reconquista.tt
				any_neighbor_country = {
					religion = sunni
				}
			}
			OR = {
				owns = 4371
				owns = 2850
				owns = 2719
				owns = 4370
				owns = 4369
				owns = 2337
                owns = 4474
                owns = 4344
                owns = 2718
                owns = 4346
                owns = 4345
                owns = 4347
			}
        }
        effect = {
            add_manpower = 5
            extremadura_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			madrid_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
            }
            toledo_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
            }
        }
    }
}

vn_cas_missions_slot_3_b = {
    slot = 8
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_conquer_la_mancha = {
        icon = mission_unite_home_region    #placeholder
        completed_by = 1266.1.1
        required_missions = {
            vn_cas_extremadura_campaign
            vn_cas_conquer_toledo
        }
        position = 3
        provinces_to_highlight = {
			OR = {
				area = ciudad_area
				area = cuenca_area
			}
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            ciudad_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
			}
			cuenca_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
        }
        effect = {
			ciudad_area = {
				limit = { NOT = { is_core = CTL } }
				add_core = CTL
			}
			cuenca_area = {
				limit = { NOT = { is_core = CTL } }
				add_core = CTL
			}
            cordoba_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			almeria_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			murcia_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
        }
    }
    vn_cas_capture_cordoba = {
        icon = mission_develop_cordoba
        required_missions = { vn_cas_conquer_la_mancha }
        completed_by = 1246.1.1
        provinces_to_highlight = {
            area = cordoba_area
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            cordoba_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			add_prestige_or_monarch_power = { amount = 10 } 
			cordoba_area = {
				limit = { NOT = { is_core = CCR } }
				add_core = CCR
			}
            cordoba_area = {
                limit = { country_or_non_sovereign_subject_holds = ROOT }
                add_province_modifier = {
                    name = "cas_claim_sevilla_mission"
                    duration = 9125
                }
            }
            malaga_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
            }
            granada_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
        }
    }
    vn_cas_gates_of_granada = {
        icon = mission_develop_alhambra
        completed_by = 1492.1.2
        required_missions = { 
			vn_cas_capture_cordoba
			vn_cas_claim_sevilla
			vn_cas_conquer_almeria
		}
        provinces_to_highlight = {
            OR = {
                area = malaga_area
                area = granada_area
            }
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            malaga_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
            granada_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			malaga_area = {
				limit = { NOT = { is_core = CGR } }
				add_core = CGR
			}
			granada_area = {
				limit = { NOT = { is_core = CGR } }
				add_core = CGR
			}
			add_prestige_or_monarch_power = { amount = 10 } 
            malaga_area = {
                limit = { country_or_non_sovereign_subject_holds = ROOT }
                add_province_modifier = {
                    name = "cas_gates_of_granada_mission"
                    duration = 9125
                }
            }
            granada_area = {
                limit = { country_or_non_sovereign_subject_holds = ROOT }
                add_province_modifier = {
                    name = "cas_gates_of_granada_mission"
                    duration = 9125
                }
            }
            443 = {
                add_province_modifier = {
                    name = "cas_gates_of_granada_mission2"
                    duration = 9125
                }
            }
        }
    }
    vn_cas_triumph_over_islam = {
        icon = mission_golden_century
        completed_by = 1492.1.2
        required_missions = { vn_cas_gates_of_granada }
        provinces_to_highlight = {
            superregion = iberia_superregion
            owner = { religion_group = muslim }
        }
        trigger = {
			custom_trigger_tooltip = {
				tooltip = vn_cas_triumph_over_islam.tt
				NOT = {
					any_known_country = {
						religion_group = muslim
						iberia_superregion = {
							owned_by = PREV
						}
					}
				}
			}
        }
        effect = {
			set_country_flag = fate_of_granada_mission_flag
			country_event = {
				id = flavor_spa.8
			}
            add_prestige_or_monarch_power = { amount = 10 } 
            add_power_projection = {
				type = mission_rewards_power_projection
				amount = 20
			}
			add_religious_influence_effect_small = yes
			4626 = {
				if = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
			4627 = {
				if = {
					limit = {
						NOT = { is_core = ROOT }
						NOT = { is_permanent_claim = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
        }
    }
    vn_cas_moroccan_outposts = {
        icon = mission_moroccan_ports
        required_missions = { vn_cas_triumph_over_islam }
		position = 8
		provinces_to_highlight = {
			OR = {
				region = rif_region
				region = gharb_region
				area = taroudant_area
				area = guelmim_area
			}
			has_port = yes
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
        trigger = {
			4626 = { country_or_non_sovereign_subject_holds = ROOT }
			4627 = { country_or_non_sovereign_subject_holds = ROOT }
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 20
				has_port = yes
				OR = {
					region = rif_region
					region = gharb_region
					area = taroudant_area
					area = guelmim_area
				}
			}
        }
        effect = {
			rif_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			gharb_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			sus_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			high_atlas_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
			middle_atlas_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
				}
				add_claim = ROOT
			}
        }
    }
    vn_cas_riches_of_maghreb = {
        icon = mission_control_the_barbary_coast
		required_missions = { vn_cas_moroccan_outposts }
		provinces_to_highlight = {
			superregion = maghreb_superregion
			has_port = yes
			NOT = { development = 15 }
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
        trigger = {
			num_of_owned_provinces_with = {
				value = 10
				development = 15
				has_port = yes
				superregion = maghreb_superregion
			}
        }
        effect = {
			add_adm_power = 50
			coastal_tunisia_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			oran_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			saida_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			bejaia_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			constantine_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
        }
	}
}

vn_cas_missions_slot_4_a = {
    slot = 9
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_conquer_toledo = {
        icon = mission_unite_home_region    #placeholder
        completed_by = 1213.1.1
        required_missions = { vn_cas_prepare_reconquista }
        position = 2
        provinces_to_highlight = {
			OR = {
				area = toledo_area
				area = madrid_area
			}
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
			madrid_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
            toledo_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			add_prestige_or_monarch_power = { amount = 10 } 
			madrid_area = {
				limit = { NOT = { is_core = CTL } }
				add_core = CTL
			}
			toledo_area = {
				limit = { NOT = { is_core = CTL } }
				add_core = CTL
			}
            cuenca_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			ciudad_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
            }
        }
    }
    vn_cas_conquer_almeria = {
        icon = mission_unite_home_region    #placeholder
        completed_by = 1492.1.2
		required_missions = { vn_cas_conquer_la_mancha }
		position = 4
        provinces_to_highlight = {
			OR = {
				area = almeria_area
				area = murcia_area
			}
            NOT = { country_or_non_sovereign_subject_holds = ROOT }
        }
        trigger = {
            almeria_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
			}
			murcia_area = {
                type = all
                country_or_non_sovereign_subject_holds = ROOT
            }
        }
        effect = {
			murcia_area = {
				limit = { NOT = { is_core = CMU } }
				add_core = CMU
			}
			almeria_area = {
				limit = { NOT = { is_core = CGR } }
				add_core = CGR
			}
			add_adm_power = 50
			add_prestige_or_monarch_power = { amount = 5 } 
        }
    }
}

vn_cas_missions_slot_4_b = {
    slot = 9
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_influence_in_occitania = {
        icon = mission_invade_occitania
        required_missions = { vn_cas_subjugate_navarra }
        position = 5
        provinces_to_highlight = {
            region = toulouse_region
            NOT = { owned_by = ROOT }
        }
        trigger = {
            OR = {
                custom_trigger_tooltip = {
                    tooltip = vn_brc_influence_in_occitania.tt
                    num_of_owned_provinces_with = {
                        value = 5
                        region = toulouse_region
                    }
                }
                calc_true_if = {
                    desc = vn_brc_influence_in_occitania.tt2
                    all_country = {
                        capital_scope = {
                            region = toulouse_region
                        }
                        has_opinion = {
                            who = ROOT
                            value = 100
                        }
                    }
                    amount = 3
                }
            }
        }
        effect = {
            provence_region = {
                limit = {
                    NOT = { is_core = ROOT }
                    NOT = { is_permanent_claim = ROOT }
                }
                add_permanent_claim = ROOT
            }
        }
    }
}

vn_cas_missions_slot_4_c = {
    slot = 9
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_spanish_inquisition = {
        icon = mission_establish_jesuit_missions
        required_missions = { vn_cas_triumph_over_islam }
        position = 7
        provinces_to_highlight = {
            country_or_non_sovereign_subject_holds = ROOT
            superregion = iberia_superregion
            religion_group = muslim
        }
        trigger = {
            NOT = {
                any_owned_province = {
                    superregion = iberia_superregion
                    religion_group = muslim
                }
            }
            if = {
                limit = {
                    any_subject_country = {
                        any_owned_province = {
                            superregion = iberia_superregion
                        }
                    }
                }
                NOT = {
                    any_subject_country = {
                        any_owned_province = {
                            superregion = iberia_superregion
                            religion_group = muslim
                        }
                    }
                }
            }
			NOT = { full_idea_group = humanist_ideas }
			full_idea_group = religious_ideas
        }
        effect = {
            add_country_modifier = {
                name = "cas_spanish_inquisition_mission"
                duration = 9125
            }
        }
    }
    vn_cas_assimilate_moors = {
        icon = mission_expel_the_moriscos
        required_missions = { vn_cas_spanish_inquisition }
        provinces_to_highlight = {
            country_or_non_sovereign_subject_holds = ROOT
            superregion = iberia_superregion
            culture = andalucian
        }
        trigger = {
            NOT = {
                num_of_owned_provinces_with = {
                    superregion = iberia_superregion
					culture = andalucian
					value = 10
                }
            }
            if = {
                limit = {
                    any_subject_country = {
                        any_owned_province = {
                            superregion = iberia_superregion
                        }
                    }
                }
                NOT = {
                    any_subject_country = {
                        any_owned_province = {
                            superregion = iberia_superregion
                            religion_group = muslim
                        }
                    }
                }
            }
        }
        effect = {
            add_dip_power = 50
            add_country_modifier = {
                name = "cas_assimilate_moors_mission"
                duration = 9125
            }
        }
    }
}

vn_cas_missions_slot_4_d = {
    slot = 9
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

	vn_cas_curb_barbary_piracy = {
		icon = mission_combat_barbary_piracy
		position = 9
        required_missions = { vn_cas_moroccan_outposts }
        provinces_to_highlight = {
            province_id = 1946
        }
		trigger = {
			1946 = {
				trade_share = {
					country = ROOT
					share = 25
				}
			}
			num_ships_privateering = 15
		}
		effect = {
			add_country_modifier = {
				name = "cas_curb_barbary_piracy_mission"
				duration = 9125
			}
		}
	}
}

vn_cas_missions_slot_5_a = {
    slot = 10
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_conquer_rioja = {
        icon = mission_unite_home_region    #placeholder
        completed_by = 1076.6.4
        required_missions = { }
        position = 1
        provinces_to_highlight = {
			area = rioja_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
        trigger = {
            rioja_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
        }
        effect = {
            vizcaya_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
			navarra_area = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
        }
    }
    vn_cas_subjugate_navarra = {
        icon = mission_subjugate_navarra
        completed_by = 1512.7.24
        required_missions = { vn_cas_conquer_rioja }
        position = 4
        provinces_to_highlight = {
			OR = {
				area = navarra_area
				area = vizcaya_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			navarra_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			vizcaya_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		effect = {
			basque_region = {
				limit = { country_or_non_sovereign_subject_holds = ROOT }
				add_province_modifier = {
					name = "cas_subjugate_navarra_mission"
					duration = 9125
				}
			}
			gascony_region = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_permanent_claim = ROOT }
				}
				add_permanent_claim = ROOT
			}
		}	
    }
    vn_cas_beyond_pyrenees = {
		icon = mission_wine_monopolies
		position = 6
        required_missions = { vn_cas_subjugate_navarra }
        provinces_to_highlight = {
			region = gascony_region
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			gascony_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
        effect = {
			custom_tooltip = vn_cas_beyond_pyrenees.tt
			hidden_effect = {
				gascony_region = {
					limit = { 
						trade_goods = wine
						country_or_non_sovereign_subject_holds = ROOT
					}
					add_province_modifier = {
						name = "cas_beyond_pyrenees_mission"
						duration = 9125
					}
				}
			}
        }
    }
}

vn_cas_missions_slot_5_b = {
    slot = 10
    generic = no
    ai = yes
    potential = {
        OR = {
            tag = CAS
            tag = LON
            AND = {
                tag = SPA
                OR = {
                    was_tag = CAS
                    was_tag = LON
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_cas_policy_of_tolerance = {
        icon = mission_cope_with_refugees
        required_missions = { vn_cas_triumph_over_islam }
        position = 7
        trigger = {
            num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
                value = 10
                religion_group = muslim
            }
			NOT = { full_idea_group = religious_ideas }
			full_idea_group = humanist_ideas
        }
        effect = {
            add_country_modifier = {
                name = "cas_policy_of_tolerance_mission"
                duration = 9125
            }
        }
    }
    vn_cas_cultural_renaissance = {
        icon = mission_patronize_art_and_religion
        required_missions = { vn_cas_policy_of_tolerance }
        trigger = {
			employed_advisor = {
				culture = andalucian
			}
            num_accepted_cultures = 3
            accepted_culture = andalucian
        }
        effect = {
            random_list = {
                33 = {
                    define_advisor = {
                        skill = 3
                        type = philosopher
                        culture = andalucian
                        discount = yes
                    }
                }
                33 = {
                    define_advisor = {
                        skill = 3
                        type = artist
                        culture = andalucian
                        discount = yes
                    }
                }
                33 = {
                    define_advisor = {
                        skill = 3
                        type = natural_scientist
                        culture = andalucian
                        discount = yes
                    }
                }
            }
            add_country_modifier = {
                name = "cas_cultural_renaissance_mission"
                duration = 9125
            }
        }
    }
}